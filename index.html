<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <!-- discord embed -->
        <meta property="og:title" content="Password Game" />
        <meta property="og:description" content="Guess The Password" />
        <meta property="og:image" content="https://i.imgur.com/1QK2ZRy.png" />
        <meta property="og:url" content="https://guessthepassword.vercel.app" />
        <meta property="og:type" content="website" />
        <link rel="icon" href="https://i.imgur.com/sPxq6s5.png" type="image/png">

        <!-- twitter (NOT X) embed u STUPID elon -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content="Password Games" />
        <meta name="twitter:description" content="Guess The Password" />
        <meta name="twitter:image" content="https://i.imgur.com/1QK2ZRy.png" />
        <meta name="twitter:url" content="https://guessthepassword.vercel.app" />
        <meta name="twitter:site" content="@LoolyTunes" />
        <title>Password Verification</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <main class="card">
            <h1>Password Verification</h1>
            <p class="desc">Enter the correct password to proceed</p>
            <div class="row" style="margin-bottom: 10px">
                <div class="password-toggle">
                    <input
                        id="pw"
                        type="password"
                        placeholder="enter password"
                        autocomplete="off"
                    />
                    <button id="togglePw" type="button" title="Show password">üëÅ</button>
                </div>
                <button id="try" title="Try Password">‚úì</button>
            </div>
            <div class="log" id="log">Ready to verify your identity...</div>
            <div class="attempt-counter" id="attemptCounter"></div>
            <div id="hint" class="reveal" style="display: none"></div>
        </main>
        <script>
            const log = (t, type = '') => {
                const logEl = document.getElementById("log");
                if (type === 'loading') {
                    logEl.innerHTML = '<span class="loading"></span>' + t;
                } else if (type === 'success') {
                    logEl.innerHTML = '<span class="success">‚úì</span> ' + t;
                } else if (type === 'error') {
                    logEl.innerHTML = '<span class="error">‚úó</span> ' + t;
                } else {
                    logEl.textContent = t;
                }
            };
            const descEl = document.querySelector(".desc");
            const tryButton = document.getElementById("try");
            const attemptCounter = document.getElementById("attemptCounter");

            const sleep = (ms) =>
                new Promise((resolve) => setTimeout(resolve, ms));
            let revealedPassword = null;
            let attempts = 0;
            let isChecking = false;

            function getDescForAttempts(n) {
                if (revealedPassword !== null)
                    return "Password revealed! Non-clone confirmed.";
                if (n >= 8) return "Final hint: The password is made of balls";
                if (n >= 5) return "Large hint: Think of a rainbow.";
                if (n >= 3)
                    return "Referenced hint: The password is a reference to one of my more known websites.";
                if (n >= 1) return "Hint: The password is gay.";
                return "Hint: no";
            }

            function updateDescUI() {
                descEl.textContent = getDescForAttempts(attempts);
                attemptCounter.textContent = attempts > 0 ? `Attempts: ${attempts}` : '';
            }

            async function checkForPassword() {
                try {
                    const resp = await fetch("/api/get-password", {
                        cache: "no-store",
                    });
                    if (!resp.ok) {
                        updateDescUI();
                        return;
                    }
                    const j = await resp.json();
                    if (j && j.allowed && j.password) {
                        revealedPassword = j.password;
                        descEl.textContent =
                            "Password revealed! Non-clone confirmed.";
                        log(
                            "The password has been revealed, non-clone confirmed.",
                        );
                    } else {
                        updateDescUI();
                    }
                } catch (e) {
                    updateDescUI();
                }
            }

            document
                .getElementById("try")
                .addEventListener("click", tryPassword);
            document.getElementById("pw").addEventListener("keydown", (e) => {
                if (e.key === "Enter") tryPassword();
            });

            const passwordInput = document.getElementById("pw");
            const toggleButton = document.getElementById("togglePw");

            toggleButton.addEventListener("click", () => {
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleButton.textContent = "üôà";
                    toggleButton.title = "Hide password";
                } else {
                    passwordInput.type = "password";
                    toggleButton.textContent = "üëÅ";
                    toggleButton.title = "Show password";
                }
            });

            async function tryPassword() {
                if (isChecking) return;

                const attempt = document.getElementById("pw").value || "";
                if (!attempt.trim()) {
                    log("Please enter a password.", 'error');
                    return;
                }

                document.getElementById("pw").value = "";
                tryButton.disabled = true;
                tryButton.innerHTML = '<span class="loading" style="width: 16px; height: 16px; margin: 0;"></span>';
                isChecking = true;

                if (revealedPassword !== null) {
                    if (attempt === revealedPassword) {
                        log("Correct ‚Äî redirecting...", 'success');
                        await sleep(1000);
                        window.location.href =
                            "https://www.youtube.com/watch?v=9BalEldzE8o";
                    } else {
                        log(
                            "HOW CAN YOU GET IT WRONG WHEN YOU LITERALLY HAVE THE PASSWORD IN FRONT OF YOU!?",
                            'error'
                        );
                    }
                    resetButton();
                    return;
                }

                try {
                    log("Checking password...", 'loading');
                    const resp = await fetch("/api/check", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ password: attempt }),
                    });
                    if (!resp.ok) {
                        log("Server error. Please try again.", 'error');
                        resetButton();
                        return;
                    }
                    const j = await resp.json();
                    if (j && j.ok) {
                        attempts = 0;
                        updateDescUI();
                        log("Correct ‚Äî redirecting...", 'success');
                        await sleep(1000);
                        window.location.href =
                            j.redirect ||
                            "https://www.youtube.com/watch?v=9BalEldzE8o";
                    } else {
                        attempts++;
                        updateDescUI();
                        log("Try a different password.", 'error');
                    }
                } catch (e) {
                    log("Connection error. Please try again.", 'error');
                }
                resetButton();
            }

            function resetButton() {
                tryButton.disabled = false;
                tryButton.innerHTML = "‚úì";
                isChecking = false;
            }

            checkForPassword();
        </script>
            <div style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
            <a href="https://tunesis-awebdev.vercel.app" target="_blank" style="text-decoration: none;">
                <button style="
                    background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #1e3a8a 50%, #073e96 75%, #025272 100%);
                    color: white;
                    border: none;
                    border-radius: 30px;
                    padding: 12px 20px;
                    font-size: 14px;
                    font-weight: bold;
                    cursor: pointer;
                    box-shadow: 0 4px 15px rgba(30, 58, 138, 0.3), 0 0 25px rgba(59, 130, 246, 0.2);
                    transition: all 0.3s ease;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(30, 58, 138, 0.5), 0 0 35px rgba(59, 130, 246, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(30, 58, 138, 0.3), 0 0 25px rgba(59, 130, 246, 0.2)'">
                    My socials and projects
                </button>
            </a>
        </div>
    </body>
</html>
